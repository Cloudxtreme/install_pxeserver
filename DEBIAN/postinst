#!/bin/sh
# postinst script for mypackage
#
# see: dh_installdeb(1)

set -e

# summary of how this script can be called:
#        * <postinst> `configure' <most-recently-configured-version>
#        * <old-postinst> `abort-upgrade' <new version>
#        * <conflictor's-postinst> `abort-remove' `in-favour' <package>
#          <new-version>
#        * <postinst> `abort-remove'
#        * <deconfigured's-postinst> `abort-deconfigure' `in-favour'
#          <failed-install-package> <version> `removing'
#          <conflicting-package> <version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package


case "$1" in
configure)
    #specify file paths
    ifaces='/etc/network/interfaces'
    dhcpdefault='/etc/default/isc-dhcp-server'
    dhcpconf='/etc/dhcp/dhcpd.conf'
    
     
	#add stanzas to interfaces file
	
	grep -q pxeserv /etc/network/interfaces || cat >> /etc/network/interfaces << EOF
iface pxesrv inet static
   address 192.168.0.1
   netmask 255.255.255.0
#config for uplink interface
   iface uplink inet dhcp
   EOF
	
	#add listening interface to dhcpd.conf
	grep -q eth0 $dhcpdefault || echo 'INTERFACES="eth0" ' >> $dhcpdefault

	grep -q 'pxe-server' $dhcpconf || cat > $dchpconf << EOF
#generated by install-pxe-server 
ddns-update-style none; 

# option definitions common to all supported networks...
option domain-name "admin.freegeekseattle";
option domain-name-servers 8.8.8.8, 4.4.2.1;

default-lease-time 600;
max-lease-time 7200;

allow booting;

subnet 192.168.0.0 netmask 255.255.255.0 {
    range 192.168.0.3 192.168.0.127;
    option broadcast-address 192.168.0.255;
    option routers 192.168.0.1;
    filename "pxelinux.0";
}

group {
    next-server 192.168.0.1;
    host tftpclient {
        filename "pxelinux.0";
    }
}
#end of generated config
EOF



;;

abort-upgrade|abort-remove|abort-deconfigure)
;;

*)
echo "postinst called with unknown argument \`$1'" >&2
exit 1
;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.



#DEBHELPER#

exit 0

